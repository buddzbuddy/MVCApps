@{
    ViewBag.Title = "Муниципальные территориальные управления";
}

<h2>Муниципальные территориальные управления</h2>

@section heads{
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <style>
        #map {
            width: 850px;
            height: 500px;
            border: 1px solid #000000;
        }
    </style>
}
<div id="map"></div>
Latitude @Html.TextBox("Latitude", null, new { @readonly = true }) | Longitude @Html.TextBox("Longitude", null, new { @readonly = true })
@section scripts{
    <script type='text/javascript'>
        var map = L.map('map').setView([42.874722, 74.612222], 12);

        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a rel="nofollow" href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        //L.marker([42.874722, 74.612222]).addTo(map).bindPopup("<strong>Бишкек</strong><br />ZipCode: 720001, Kyrgyz Republic").openPopup();
        var latlng = new L.LatLng();
        
        
        var polygon = L.polygon([[42.874722, 74.612222], [42.874822, 74.612822], [42.874922, 74.612422]],
            {
                color: 'red',
                weight: 3,
                opacity: 0.5,
                smoothFactor: 1
            }).addTo(map);
        var popup = L.popup()
            .setLatLng(polygon.getBounds().getCenter())
            .setContent('<strong>Бишкек</strong><br />ZipCode: 720001, Kyrgyz Republic')
            .openOn(map);
        polygon.bindPopup(popup);
        map.fitBounds(polygon.getBounds());

        var markerCount = 0;
        var markers = [];
        map.on('click', function (e) {
            $('#Latitude').val(e.latlng.lat);
            $('#Longitude').val(e.latlng.lng);
            var marker = L.marker(e.latlng, { draggable: true }).addTo(map).bindPopup(popup);
            $('<input/>').attr('type', 'text').attr('id', 'marker_' + markerCount + '_lat').attr('name', 'marker_' + markerCount + '_lat').val(e.latlng.lat).insertBefore('#map');
            $('<input/>').attr('type', 'text').attr('id', 'marker_' + markerCount + '_lng').attr('name', 'marker_' + markerCount + '_lng').val(e.latlng.lng).insertBefore('#map');
            markers.push(marker);
            marker.on('drag', function (event) {
                var position = event.target.getLatLng();
                
                $('#marker_' + markerCount + '_lat').val(position.lat);
                $('#marker_' + markerCount + '_lng').val(position.lng);
                //$('#marker_' + markerCount + '_lat').val(position.lat);
                //$('#marker_' + markerCount + '_lng').val(position.lng);
                //alert(position);
                //marker.setLatLng([position], { id: uni, draggable: true }).bindPopup(position).update();
            });
            markerCount++;
        });


    </script>
}